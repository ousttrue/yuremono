# 衝突判定

衝突図形の組合せによる実装難易度。
片方を球にしておくと簡単さを維持できる。
カプセルの難易度は相手次第。

数学は内積や外積レベルで実装。

## 既存

### 球 対 球(vrm-0.x)

簡単。

- SpringBone のひもの先端に半径を指定した球
- 衝突Object に半径を指定した球

### 球 対 Capsule(vrm-1.0)

- SpringBone のひもの先端に半径を指定した球
- 衝突Object に半径を指定したカプセル

球からカプセル線分に垂線をおろすことで最近点を求める。
最近点に半径Rの球があるとして球対球の衝突判定にできる。
簡単。

## clothの四角区画との衝突実験

:::tip

ゆれもの と Collider だと、
ゆれものが詳細な当たり判定を持っているほうが貫通防止に有利。
また、cloth の四角を流用するので設定が楽。

collider の方は humanoid が想定されるので、
球より capsule で設定を楽したい。
:::

### 三角形 対 球

- 三角形平面に球の中心投影し、球の中心との距離が半径を越えない
- 投影点が三角形三辺の内側にある(外積+内積)
- 三角形三辺と球の中心との距離が半径を越えない(三角形の外側からカプセルの半径分の衝突)

:::warning
ちょっと難しい。
:::

### 三角形 対 カプセル

- カプセルの両端を三角形平面に投影する
- 平面との距離が半径を越える範囲を対象外とする
- 投影した点が三角形内部にあるか判定(外積+内積)
- 投影線分と三角形辺との交差
- 三辺とカプセル線分の距離が半径以下

:::danger
思ったより難しい。
:::

## 振動

衝突判定が甘いと振動しやすい。

例えば `三角形 対 球` の3つめの判定

> 三角形三辺と球の中心との距離が半径を越えない(三角形の外側からカプセルの半径分の衝突)

が無いと三角形内部になった瞬間に衝突量が半径分増え
出たときに一挙に0になるため、
境界で出入りを繰り返すと振動する。
フレーム間で衝突量が滑らかに変化することが重要。
