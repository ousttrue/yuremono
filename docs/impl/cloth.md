# Cloth(布拡張)

隣合う紐を横連結することで布を構築します。

```
|  |  |
v--v--v
|  |  |
v--v--v
|  |  |
v--v--v
```

四角の区画ひとつひとつが布コンポーネントになります。
追加の横拘束と三角形衝突を実装します。

## constraint

```
d-c
| |
a-b
```

`a-b` といふう横に拘束します。
`a-c`, `d-b` は震えるのでやめています。
`c-d` は隣の区画と重複するので作りません。

:::tip
ばねの法則で実装しているが単位、ばね係数がよくわからないものに。

フレーム単位の撃力？
:::

## collision

```
d o c
 / \
a---b
```

:::tip

abcd 4点があるときに、a b (c+d)2 の三角形一枚で実装しています。

:::

### Triangle(Cloth) x Sphere Collider

Cloth の四角形の区画から三角形を得る。

三角形を含む平面に球の中心を投影し、投影した点が三角形に含まれるか。

### Triangle(Cloth) x Capsule Collider

Cloth の四角形の区画から三角形を得る。

三角形を含む平面とカプセルの端点の距離を得る。
カプセルの端点を結ぶ線分を、三角形を含む平面との距離がカプセルの半径以下である範囲にclipする。
clip された線分の端点を三角形平面に投影する。
投影された線分と三角形の各辺の交差を判定する。

交差数 0,1,2,3 で場合わけする。
0: 投影点が両方とも三角形内である。head, tail
1: 交点、head or tail(三角形内の方)
2：2交点
3: 任意の2交点

交差した場合2つの交点が得られる。
2つの交点のカプセルと近い方を選択。

交差距離を確定。

## 衝突反映

a と b を`衝突球` の中心から衝突点の方向に押す。

